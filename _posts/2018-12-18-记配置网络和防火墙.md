---
layout:     post
title:      "配置网络和防火墙小记"
subtitle:   "搞机搞机搞机...."
date:       2018-12-18 12:00:00
author:     "rain"
header-img: "img/post-bg-2018-12-18-network.png"
catalog: true
tags:
    - centos
    - shell
    - 服务器
    - firewalld
    - network
    - 多网口
---
##### get一台局域网服务器
今天配置服务器。因为学校接入网络需要登录上网账号。为了方便，服务器接了两个网口，一个是路由器（路由器也接到交换机上，不过会登录老师的上网账号）下的，一个是直接接交换机。
<br/>
处理器一般，不过有十框框，内存32GB，硬盘1T。至少比树莓派强，还可以做内网网盘用，做测试机。

##### 双网口配置

给服务器装的CentOS7 minimal，如果只是日常使用就不需要图形化，将来要做别的在考虑装图形化界面。
<br/>
网卡上有两个网口。一个口直接接内网的接口（方便远程），一个口接路由器（多了一层NAT）。
<br/>
本来想着，Linux应该很智能，我要上网他就用走路由器，我要远程操控我就通过走内网口。结果，不出意外，上不了网。curl 上不了外网，yum无法下载软件。
<br/>
关键在于：服务器所在网段是网络中心预留的，这里要手动配置ip，子网掩码和网关。
于是我觉得应该是dns配置出错。打开/etc/resolv.conf。果然，里面没内容。加了一条 nameserver 8.8.8.8 果然，服务器能正常上网了。
##### 防火墙配置的怪事
然后我遇到的另一个问题就是firewall-cmd。开始看了下域public 作用网口 eth0 eth1,对外开放端口无。于是想着开放ss和ssh的端口，之后查询该端口是否开放，结果得到返回结果no。执行firewall-cmd –reload也是一样。后来通过systemctl工具重启firewalld服务之后才正常。有意思的是，这个过程我一直是连着ssh的。
<br/>
我猜新的系统在ssh连接的时候在防火墙关闭ssh端口不会马上生效，会一直保持连接，知道network重启？所以就是这个原因我修改端口reload也不会马上起作用？
##### 参考文章
[CentOS7使用firewalld打开关闭防火墙与端口-莫小安](https://www.cnblogs.com/moxiaoan/p/5683743.html)
